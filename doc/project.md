# プロジェクト構造

## 概要

炊紙（kashikishi）は三次元空間上でテキストを編集できるテキストエディタです。  
Rust & WebGPU(wgpu)で開発されており、従来のテキストエディタにはない滑らかな編集体験を提供することを目指しています。

## アーキテクチャ

このプロジェクトはRustのワークスペース構成を採用し、機能ごとに独立したクレートで構成されています。以下に主要なクレートとその役割を示します。

## 主要クレート

### kashikishi（メインアプリケーション）
- **パス**: `kashikishi/`
- **役割**: メインの実行ファイルとなるアプリケーション
- **依存関係**: 他の全てのクレートを統合し、最終的なテキストエディタを提供

### font_rasterizer（フォントレンダリング）
- **パス**: `font_rasterizer/`
- **役割**: フォントのラスタライゼーションとレンダリング処理
- **特徴**: WebGPU(wgpu)を使用したGPUベースのフォント描画
- **ライブラリタイプ**: `cdylib`、`rlib`（WebAssemblyにも対応）

### text_buffer（テキスト管理）
- **パス**: `text_buffer/`
- **役割**: テキストデータの格納と操作を担当
- **機能**: 
  - テキストバッファ管理
  - エディタ機能
  - カーソル（キャレット）制御
  - 文字種判定

### font_collector（フォント収集）
- **パス**: `font_collector/`
- **役割**: システムフォントの検索と収集
- **機能**: OS別フォントの自動検出とロード

### stroke_parser（入力解析）
- **パス**: `stroke_parser/`
- **役割**: キーボードとマウス入力の解析と処理
- **機能**: 
  - キー入力の処理
  - マウスアクションの処理
  - 入力ストロークの解析

### ui_support（UI支援）
- **パス**: `ui_support/`
- **役割**: ユーザーインターフェースの支援機能
- **依存関係**: `nenobi`（外部ライブラリ）を使用

## 支援・実験的クレート

### rokid_3dof（3DOF制御）
- **パス**: `rokid_3dof/`
- **役割**: 3自由度（3DOF）デバイスの制御
- **特徴**: HID API を使用したハードウェア連携
- **依存関係**: `hidapi`、`vqf-rs`（姿勢推定）

### ttf_overlap_remover（フォント最適化）
- **パス**: `ttf_overlap_remover/`
- **役割**: TTFフォントの重複除去と最適化
- **依存関係**: `rustybuzz`、`tiny-skia-path`

### font_rasterizer_example（サンプル）
- **パス**: `font_rasterizer_example/`
- **役割**: font_rasterizerクレートの使用例
- **特徴**: WebAssembly向けのビルド対応

## サンプルコード

### sample_codes/
- **showcase/**: プロジェクトのデモンストレーション
- **win_hello/**: Windows向けのHello Worldサンプル

## ドキュメント・リソース

### doc/
- **assets/**: ドキュメント用の画像・リソースファイル
- **memo/**: 開発メモ

### fonts/
- システムフォントの補完用フォントファイル
- `BIZUDMincho-Regular.ttf`: BIZ UDMincho フォント
- `NotoEmoji-Regular.ttf`: Noto Emoji フォント

### site/
- **役割**: mdBook を使用したドキュメントサイト
- **設定**: `book.toml` で日本語対応設定

## ビルド・開発環境

### 設定ファイル
- `Cargo.toml`: ワークスペース設定とメンバー定義
- `rust-toolchain.toml`: Rustツールチェインバージョン固定
- `mise.toml`、`mise.debug.toml`: 開発環境管理

### スクリプト
- `build-sites.sh`: サイトビルドスクリプト
- `dev-sites.sh`: 開発用サイトサーバー起動
- `release.sh`: リリース用ビルドスクリプト

## 技術スタック

- **言語**: Rust (Edition 2024)
- **グラフィックス**: WebGPU (wgpu 26.0.1)
- **ウィンドウ**: winit (カスタムフォーク版)
- **フォントレンダリング**: 自前実装 + GPU処理
- **入力処理**: winit + 独自解析エンジン
- **3D数学**: cgmath
- **シリアライゼーション**: serde

## 設計思想

1. **モジュラー設計**: 機能を独立したクレートに分離
2. **GPU活用**: 高性能なレンダリングのためのWebGPU使用
3. **クロスプラットフォーム**: WebAssembly対応を含む
4. **アニメーション重視**: 滑らかなユーザーインターフェース
5. **3D空間**: 従来の2Dテキストエディタの概念を拡張

このアーキテクチャにより、従来のテキストエディタとは異なるユーザーエクスペリエンスの提供を目指しています。
